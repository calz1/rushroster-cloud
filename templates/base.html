<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RushRoster Cloud{% endblock %}</title>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Chart.js for statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/styles.css">

    {% block extra_head %}{% endblock %}
</head>
<body>
    {% if current_user %}
    <nav>
        <div class="nav-content">
            <a href="/dashboard" class="logo">ðŸš— RushRoster Cloud</a>
            <div class="nav-links">
                <a href="/dashboard" class="{% if request.url.path == '/dashboard' %}active{% endif %}">Dashboard</a>
                <a href="/devices" class="{% if '/devices' in request.url.path %}active{% endif %}">Devices</a>
                <a href="/events" class="{% if '/events' in request.url.path %}active{% endif %}">Events</a>
                <a href="/stats" class="{% if '/stats' in request.url.path %}active{% endif %}">Statistics</a>
                <a href="/public" class="{% if '/public' in request.url.path %}active{% endif %}">Public Map</a>
                <a href="/docs" target="_blank">API Docs</a>
                {% if current_user.is_admin %}
                <a href="/admin" class="{% if '/admin' in request.url.path %}active{% endif %}" style="color: #fbbf24;">Admin</a>
                {% endif %}
                <span style="color: #64748b;">|</span>
                <span style="color: #94a3b8;">{{ current_user.email }}{% if current_user.is_admin %} <span style="color: #fbbf24; font-size: 0.75rem;">ADMIN</span>{% endif %}</span>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </nav>
    {% else %}
    <nav>
        <div class="nav-content">
            <a href="/" class="logo">ðŸš— RushRoster Cloud</a>
            <div class="nav-links">
                <a href="/auth/login">Login</a>
                <a href="/auth/register">Register</a>
            </div>
        </div>
    </nav>
    {% endif %}

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // Toast notification system
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;

            const container = document.getElementById('toast-container');
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Handle HTMX events for toast notifications
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            if (evt.detail.successful) {
                const response = evt.detail.xhr.response;
                try {
                    const data = JSON.parse(response);
                    if (data.message) {
                        showToast(data.message, 'success');
                    }
                } catch (e) {
                    // Not JSON response, ignore
                }
            } else {
                showToast('Request failed. Please try again.', 'error');
            }
        });

        // Handle HTMX errors
        document.body.addEventListener('htmx:responseError', function(evt) {
            showToast('An error occurred. Please try again.', 'error');
        });
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
